---
title: 'consoleでデータベース情報を削除する'
date: '2023-12-22'
tags: ['Ruby', 'Rails', 'Cloud9']
excerpt: 'Railsのconsoleを使用してデータベースの情報を削除する方法について、具体的な手順を解説します'
---

サンプルデータを作りすぎた。ごちゃごちゃしてるから減らしたい。ここからここのデータだけ、条件を指定して削除したい。そんなときに使える方法。

`railsのconsoleでデータベースを削除`

先日メンターさんがちょこちょこっとリモートでターミナル操作しているのを見て、そういう使い方もあったのかと新たな気づきがあったのでZennで初の投稿をしてみることに。

## 前提
- Ruby-3.1.2
- Rails 6.1.7.6
- OS: Windows 10
- 開発環境: Cloud9

> **Warning**
> データを削除する場合、dependent: :destroyなど関連付いたモデルがあるとそちらのデータも同時に消えてしまうので注意。

## やってみよう
ターミナルで以下のコマンドを実行し、コンソール起動
```bash
$ rails c
```

`rails c`の c はconsoleの略。
このコマンドは削除だけでなく、サーバーのデータ変更やアプリケーションに定義したメソッドを試す時にも使える。

### 特定のデータを消したい
まずモデルの中でこのデータだけ消したいというときには`id`を指定し`destroy`を使って削除する。例えば`Order`モデルで指定した`id`のデータを削除する場合には以下のようになる。

```ruby
モデル名.find(id).destroy
Order.find(id).destroy
```

### 条件を指定して削除したい
今度はここからここまでのデータを消したいという条件付きで行いたい場合。その消したい範囲を指定してあげれば希望の条件で削除可能。例えば`Order`モデルの中で`id`が`1..10`までのものを消したいのであれば以下のようになる。

```ruby
Order.where(id:1..10).destroy_all
```

### データをすべて消したい
さらにそのモデルのデータぜんぶ消したい！というときには`destroy_all`を使って消すことができる。

```ruby
Order.find(id).destroy_all
```

### 💡削除できたか確認したい、コンソール抜け出したいってときは
上記それぞれ実行した後、本当に削除できたか確認したいときには`モデル名.all`とコンソールに打てば現状データベースがもっているそのモデル内にあるデータ一覧を出してくれる。
またやりたいことが終わってコンソールから抜け出したいときは`exit`と打ち込んで`Enter`を押すとコンソールが終了し、いつものターミナルの状態に戻る。

## 余談
### ◆ db:resetやdb:migrate:resetという手も
これらはコンソールで行うものではないが、以下2つのコマンドでもデータベースの削除は可能。

```bash
$ rails db:reset
$ rails db:migrate:reset
```

> **Warning**
> ただしこのコマンドを実行するとテーブルが一旦全て削除される。

`rails db:reset`ではマイグレーションファイルを編集しても内容は反映されずマイグレーションも実行しないが、`rails db:migrate:reset`の場合はデータベースをDropした後、通常通りの`db:migrate`が実行される。

この辺まだいまいちつかめていないので、またまとめれたらいいな。