---
title: '【Rails】consoleでデータベース情報を削除する方法'
date: '2023-12-22'
tags: ['Ruby', 'Rails', 'Cloud9']
excerpt: 'Railsのconsoleを使用してデータベースの情報を削除する方法について、具体的な手順を解説します'
---

先日メンターさんがターミナル操作をしているところを見て、そういう使い方もあったのかと新たな気づきがあったので、Zennで初の投稿をしてみることにしました。
サンプルデータを作りすぎた。ごちゃごちゃしてるから減らしたい。ここからここのデータだけ条件を指定して削除したい。そんなときに使える方法をまとめてみます。

## 前提
・Ruby-3.1.2  
・Rails 6.1.7.6  
・OS: Windows 10  
・開発環境: Cloud9

## 始める前に
データを削除する場合、`dependent: :destroy`など関連付いたモデルがあるとそちらのデータも同時に消えてしまうので注意が必要です。

## やってみよう
ターミナルで以下のコマンドを実行し、コンソール起動
```bash
$ rails c
```
`rails c`の c はconsoleの略。
このコマンドは削除だけでなく、サーバーのデータ変更やアプリケーションに定義したメソッドを試す時にも使えます。

## 特定のデータを消したい
まず、モデルの中でこのデータだけ消したいというときには`id`を指定し、`destroy`を使って削除します。
例えば、`Order`モデルで指定した`id`のデータを削除する場合には以下のようになります。
```ruby
モデル名.find(id).destroy
Order.find(1).destroy
```

## 条件を指定して削除したい
今度はここからここまでのデータを消したいという条件付きで行いたい場合。
その消したい範囲を指定してあげれば希望の条件で削除可能です。
例えば、`Order`モデルの中で`id`が`1..10`までのものを消したいのであれば、以下のようになります。
```ruby
Order.where(id: 1..10).destroy_all
```

## データをすべて消したい
そのモデルのデータをぜんぶ消したい！というときには`destroy_all`を使って消すことができます。
```ruby
Order.destroy_all
```

## 💡削除できたか確認したい、コンソールを抜けたいときは
上記それぞれ実行した後、本当に削除できたか確認したいときには`モデル名.all`とコンソールに打ちます。
すると、現状データベースがもっているそのモデル内にあるデータ一覧を出してくれます。
また、やりたいことが終わってコンソールから抜けたいときには`exit`と打ち込んで`Enter`を押すとコンソールが終了し、いつものターミナルの状態に戻ります。

## 余談
### ☝🏻db:resetやdb:migrate:resetという手も
これらはコンソールで行うものではありませんが、以下2つのコマンドでもデータベースの削除は可能です。
```bash
$ rails db:reset
$ rails db:migrate:reset
```

> **Warning**
> ただしこのコマンドを実行するとテーブルが一旦全て削除されます。

`rails db:reset`では`schema.rb`からデータベースを復元し、seedも実行されます。
マイグレーションファイルを編集しても内容は反映されません。
`rails db:migrate:reset`の場合は**全マイグレーションファイル**を順番に再実行します。
マイグレーションファイルの変更は反映されますが、seedは実行されません。
この辺はまだいまいちつかめていないので、また機会があればまとめたいと思います。

## 参考リンク
今回の記事に関連する公式ドキュメントや参考情報です。
- [コマンドラインツール - Railsガイド](https://railsguides.jp/command_line.html) - Rails consoleの公式ドキュメント
- [Active Record の関連付け (アソシエーション) - Railsガイド](https://railsguides.jp/association_basics.html) - dependentオプションについての公式解説
- [Active Record クエリインターフェイス - Railsガイド](https://railsguides.jp/active_record_querying.html) - destroy_allやwhereメソッドなどの公式リファレンス

---
最後まで読んでいただきありがとうございました。
当方プログラミング学習始めてもうすぐ2カ月の初学者です。
プラスの情報や修正点等ありましたら、ご連絡いただけますと幸いです🧎🏻‍♂️